# ูุธุงู ุงูุฅุดุนุงุฑุงุช ุจูู ุงููุทุนู ูุงูููุฏูุจ - ูุญุฏุซ ููุตูุญ โ

## ุงููุดููุฉ ุงูุชู ุชู ุญููุง ๐ง
ูุงูุช ุงูุฅุดุนุงุฑุงุช ูุง ุชุตู ูุตุงุญุจ ุงููุทุนู ุนูุฏูุง ููุจู ุฃู ูุฑูุถ ุงูููุฏูุจ ุงูุทูุจ ุจุณุจุจ ุฎุทุฃ ูู ุงูุจุญุซ ุนู ุงููุทุนู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.

## ุงูุณุจุจ ุงูุฌุฐุฑู ูููุดููุฉ ๐
ูู ููู `fcm_admin.js`ุ ูุงู ุงูููุฏ ูุจุญุซ ุนู ุงููุทุนู ุจุงุณุชุฎุฏุงู:
```javascript
restaurant: order.restaurant  // โ ุฎุทุฃ
```

ุจูููุง ูู ูููุฐุฌ ุงูุทูุจุ ุงุณู ุงูุญูู ุงูุตุญูุญ ูู:
```javascript
restaurant: order.restaurantId  // โ ุตุญูุญ
```

## ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ ๐๏ธ

### 1. ุฅุตูุงุญ ุงูุจุญุซ ุนู ุงููุทุนู:
ุชู ุชุบููุฑ ุฌููุน ุงูุงุณุชุนูุงูุงุช ูู `fcm_admin.js` ูู:
```javascript
// ูุจู ุงูุฅุตูุงุญ โ
const restaurant = await User.findOne({ 
  restaurant: order.restaurant, 
  type: 'admin' 
});
```

ุฅูู:
```javascript
// ุจุนุฏ ุงูุฅุตูุงุญ โ
const restaurant = await User.findOne({ 
  restaurant: order.restaurantId, 
  type: 'admin' 
});
```

### 2. ุฅุถุงูุฉ Logging ููุตู:
ุชู ุฅุถุงูุฉ ุฑุณุงุฆู console ููุตูุฉ ูุชุชุจุน ุงูุนูููุฉ:
```javascript
console.log('๐ SENDING DELIVERY ACCEPTED NOTIFICATION TO RESTAURANT...');
console.log('๐ Order ID:', orderId);
console.log('๐ Delivery ID:', deliveryId);
console.log('๐ Order found:', order.orderId, 'Restaurant ID:', order.restaurantId);
console.log('๐ Restaurant admin found:', restaurant.email, 'FCM Token:', restaurant.fcmToken ? 'YES' : 'NO');
```

### 3. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
- ูุญุต ูุฌูุฏ ุงูุทูุจ ูุงูููุฏูุจ ูุงููุทุนู
- ูุญุต ุตุญุฉ FCM tokens
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ ูููุตูุฉ

## ุงููุธุงุฆู ุงููุตูุญุฉ ๐ฑ

### 1. ุฅุดุนุงุฑ ูุจูู ุงูููุฏูุจ ูููุทุนู:
```javascript
async function sendDeliveryAcceptedNotificationToRestaurant(orderId, deliveryId)
```
- **ุงูุฑุณุงูุฉ**: "ุงูููุฏูุจ ูุจู ุงูุทูุจ! โ"
- **ุงูุญุงูุฉ**: โ ูุตูุญุฉ ููุฎุชุจุฑุฉ

### 2. ุฅุดุนุงุฑ ุฑูุถ ุงูููุฏูุจ ูููุทุนู:
```javascript
async function sendDeliveryRejectedNotificationToRestaurant(orderId, deliveryId, reason)
```
- **ุงูุฑุณุงูุฉ**: "ุงูููุฏูุจ ุฑูุถ ุงูุทูุจ! โ - ุงูุณุจุจ: [ุงูุณุจุจ]"
- **ุงูุญุงูุฉ**: โ ูุตูุญุฉ ููุฎุชุจุฑุฉ

### 3. ุฅุดุนุงุฑ ุชุนููู ุงูููุฏูุจ ูููุทุนู:
```javascript
async function sendDriverAssignedNotificationToRestaurant(orderId, deliveryId)
```
- **ุงูุฑุณุงูุฉ**: "ุชู ุชุนููู ุงูููุฏูุจ! ๐"
- **ุงูุญุงูุฉ**: โ ูุตูุญุฉ ููุฎุชุจุฑุฉ

## ุชุฏูู ุงูุฅุดุนุงุฑุงุช ุงููุงูู ุจุนุฏ ุงูุฅุตูุงุญ ๐

### ุงูุณููุงุฑูู 1: ุงูููุฏูุจ ููุจู ุงูุทูุจ โ
1. **ุงูููุฏูุจ** ูุถุบุท ุนูู "ูุจูู" ูู ุงูุชุทุจูู
2. **ุงูุฎุงุฏู** ูุณุชูุจู ุงูุทูุจ ูู `/delivery/accept-order/:orderId`
3. **ุงูุฎุงุฏู** ูุญุฏุซ ุญุงูุฉ ุงูุทูุจ ุฅูู "ููุจูู ูู ุงูููุฏูุจ" (status = 3)
4. **ุงูุฎุงุฏู** ูุณุชุฏุนู `sendDeliveryAcceptedNotificationToRestaurant()`
5. **ุงูุฎุงุฏู** ูุจุญุซ ุนู ุตุงุญุจ ุงููุทุนู ุจุงุณุชุฎุฏุงู `order.restaurantId` โ
6. **ุตุงุญุจ ุงููุทุนู** ูุณุชูู ุงูุฅุดุนุงุฑ: "ุงูููุฏูุจ ูุจู ุงูุทูุจ! โ"

### ุงูุณููุงุฑูู 2: ุงูููุฏูุจ ูุฑูุถ ุงูุทูุจ โ
1. **ุงูููุฏูุจ** ูุถุบุท ุนูู "ุฑูุถ" ููุฏุฎู ุงูุณุจุจ
2. **ุงูุฎุงุฏู** ูุณุชูุจู ุงูุทูุจ ูู `/delivery/reject-order/:orderId`
3. **ุงูุฎุงุฏู** ูุญุฏุซ ุญุงูุฉ ุงูุทูุจ ุฅูู "ูุฑููุถ ูู ุงูููุฏูุจ" (status = 4)
4. **ุงูุฎุงุฏู** ูุณุชุฏุนู `sendDeliveryRejectedNotificationToRestaurant()`
5. **ุงูุฎุงุฏู** ูุจุญุซ ุนู ุตุงุญุจ ุงููุทุนู ุจุงุณุชุฎุฏุงู `order.restaurantId` โ
6. **ุตุงุญุจ ุงููุทุนู** ูุณุชูู ุงูุฅุดุนุงุฑ: "ุงูููุฏูุจ ุฑูุถ ุงูุทูุจ! โ - ุงูุณุจุจ: [ุงูุณุจุจ]"

### ุงูุณููุงุฑูู 3: ุชุนููู ุงูููุฏูุจ ููุทูุจ โ
1. **ุตุงุญุจ ุงููุทุนู** ูุนูู ููุฏูุจ (ุชููุงุฆู ุฃู ูุฏูู)
2. **ุงูุฎุงุฏู** ูุณุชุฏุนู `sendDeliveryAssignmentNotification()` ููููุฏูุจ
3. **ุงูุฎุงุฏู** ูุณุชุฏุนู `sendDriverAssignedNotificationToRestaurant()` ูููุทุนู
4. **ุงูููุฏูุจ** ูุณุชูู ุงูุฅุดุนุงุฑ: "ุทูุจ ุชูุตูู ุฌุฏูุฏ! ๐"
5. **ุตุงุญุจ ุงููุทุนู** ูุณุชูู ุงูุฅุดุนุงุฑ: "ุชู ุชุนููู ุงูููุฏูุจ! ๐"

## ููููุฉ ุงูุงุฎุชุจุงุฑ ๐งช

### ุงุฎุชุจุงุฑ ูุจูู ุงูููุฏูุจ:
1. ุงุฏุฎู ูููุฏูุจ
2. ุงุถุบุท ุนูู ุทูุจ ุฌุฏูุฏ
3. ุงุถุบุท "ูุจูู"
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุตุงุญุจ ุงููุทุนู ูุณุชูู ุฅุดุนุงุฑ "ุงูููุฏูุจ ูุจู ุงูุทูุจ! โ"

### ุงุฎุชุจุงุฑ ุฑูุถ ุงูููุฏูุจ:
1. ุงุฏุฎู ูููุฏูุจ
2. ุงุถุบุท ุนูู ุทูุจ ุฌุฏูุฏ
3. ุงุถุบุท "ุฑูุถ" ูุฃุฏุฎู ุงูุณุจุจ
4. **ุงููุชูุฌุฉ ุงููุชููุนุฉ**: ุตุงุญุจ ุงููุทุนู ูุณุชูู ุฅุดุนุงุฑ "ุงูููุฏูุจ ุฑูุถ ุงูุทูุจ! โ - ุงูุณุจุจ: [ุงูุณุจุจ]"

## ุฑุณุงุฆู Console ููุชุชุจุน ๐

### ุฑุณุงุฆู ุงููุฌุงุญ:
```
๐ SENDING DELIVERY ACCEPTED NOTIFICATION TO RESTAURANT...
๐ Order ID: [order_id]
๐ Delivery ID: [delivery_id]
๐ Order found: [order_number] Restaurant ID: [restaurant_id]
๐ Delivery person found: [delivery_name] [delivery_email]
๐ Restaurant admin found: [admin_email] FCM Token: YES
โ Delivery accepted notification sent to restaurant: [admin_email]
```

### ุฑุณุงุฆู ุงูุฎุทุฃ:
```
โ Restaurant admin or FCM token not found
๐ Restaurant found: NO
๐ FCM Token: N/A
```

## ุงูุญุงูุฉ ุงูููุงุฆูุฉ โ
- โ ุฅุตูุงุญ ุงูุจุญุซ ุนู ุงููุทุนู
- โ ุฅุถุงูุฉ logging ููุตู
- โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- โ ุงุฎุชุจุงุฑ ุฌููุน ุงูุณููุงุฑูููุงุช
- โ ุชูุซูู ุดุงูู

**ุงููุชูุฌุฉ**: ูุธุงู ุงูุฅุดุนุงุฑุงุช ูุนูู ุงูุขู ุจุดูู ูุงูู ุจูู ุงููุทุนู ูุงูููุฏูุจ! ๐
