# ๐ ูุธุงู ุงูุฅุดุนุงุฑุงุช ุจูู ุงููุทุนู ูุงูุฏููููุฑู

## ๐ ุงูุชุบููุฑุงุช ุงูุชู ุชูุช

### 1. ุงูุฅุดุนุงุฑุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ

#### ุฃ) ุนูุฏ ุชุนููู ุงูููุฏูุจ (Driver Assignment)
**ูู:** ุตุงุญุจ ุงููุทุนู  
**ุฅูู:** ุงูููุฏูุจ

- โ ูุตู ุฅุดุนุงุฑ ููููุฏูุจ: "ุทูุจ ุชูุตูู ุฌุฏูุฏ! ๐"
- โ ูุตู ุฅุดุนุงุฑ ูููุทุนู: "ุชู ุชุนููู ุงูููุฏูุจ ๐"

#### ุจ) ุนูุฏ ูุจูู ุงูููุฏูุจ (Driver Acceptance)
**ูู:** ุงูููุฏูุจ  
**ุฅูู:** ุตุงุญุจ ุงููุทุนู

- โ ูุตู ุฅุดุนุงุฑ ูููุทุนู: "ุงูููุฏูุจ ูุจู ุงูุทูุจ! โ"
- ูุญุชูู ุนูู ุงุณู ุงูููุฏูุจ

#### ุฌ) ุนูุฏ ุฑูุถ ุงูููุฏูุจ (Driver Rejection)
**ูู:** ุงูููุฏูุจ  
**ุฅูู:** ุตุงุญุจ ุงููุทุนู

- โ ูุตู ุฅุดุนุงุฑ ูููุทุนู: "ุงูููุฏูุจ ุฑูุถ ุงูุทูุจ โ"
- ูุญุชูู ุนูู ุงุณู ุงูููุฏูุจ ูุณุจุจ ุงูุฑูุถ (ุฅุฐุง ููุฌุฏ)

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ

### 1. `/server/routes/fcm_admin.js`
**ุงููุธุงุฆู ุงููุถุงูุฉ:**
- `sendDriverAssignedNotificationToRestaurant()` - ุฅุดุนุงุฑ ูููุทุนู ุนูุฏ ุชุนููู ุงูููุฏูุจ
- `sendDeliveryAcceptedNotificationToRestaurant()` - ุฅุดุนุงุฑ ูููุทุนู ุนูุฏ ูุจูู ุงูููุฏูุจ
- `sendDeliveryRejectedNotificationToRestaurant()` - ุฅุดุนุงุฑ ูููุทุนู ุนูุฏ ุฑูุถ ุงูููุฏูุจ

### 2. `/server/routes/delivery.js`
**ุงูุชุนุฏููุงุช:**
- ุนูุฏ **ูุจูู ุงูุทูุจ** (Line 115-121): ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุทุนู
- ุนูุฏ **ุฑูุถ ุงูุทูุจ** (Line 162-169): ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุทุนู

### 3. `/server/routes/admin.js`
**ุงูุชุนุฏููุงุช:**
- ุนูุฏ **ุงูุชุนููู ุงููุฏูู** (Line 777-789): ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุทุนู + ุงูููุฏูุจ
- ุนูุฏ **ุงูุชุนููู ุงูุชููุงุฆู** (Line 612-624): ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุทุนู + ุงูููุฏูุจ

---

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

### ุงูุณููุงุฑูู 1: ุชุนููู ุงูููุฏูุจ
```
1. ุตุงุญุจ ุงููุทุนู ูุถุบุท "ุชุนููู ุงูุฃูุฑุจ" ุฃู ูุฎุชุงุฑ ููุฏูุจ ูุญุฏุฏ
2. โ ุงููุธุงู ูุฑุณู ุฅุดุนุงุฑ ููููุฏูุจ
3. โ ุงููุธุงู ูุฑุณู ุฅุดุนุงุฑ ูุตุงุญุจ ุงููุทุนู
```

### ุงูุณููุงุฑูู 2: ุงูููุฏูุจ ููุจู ุงูุทูุจ
```
1. ุงูููุฏูุจ ูุถุบุท "ูุจูู ุงูุทูุจ"
2. โ ุงููุธุงู ูุฑุณู ุฅุดุนุงุฑ ูุตุงุญุจ ุงููุทุนู
3. ุตุงุญุจ ุงููุทุนู ูุนูู ุฃู ุงูููุฏูุจ ูุจู ุงูุทูุจ
```

### ุงูุณููุงุฑูู 3: ุงูููุฏูุจ ูุฑูุถ ุงูุทูุจ
```
1. ุงูููุฏูุจ ูุถุบุท "ุฑูุถ ุงูุทูุจ" + ูุฏุฎู ุงูุณุจุจ
2. โ ุงููุธุงู ูุฑุณู ุฅุดุนุงุฑ ูุตุงุญุจ ุงููุทุนู
3. ุงููุธุงู ูุจุญุซ ุนู ููุฏูุจ ุขุฎุฑ ุชููุงุฆูุงู
4. โ ูุฑุณู ุฅุดุนุงุฑ ููููุฏูุจ ุงูุฌุฏูุฏ
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุชุนููู ุงูููุฏูุจ
```bash
# ูู ูุงุฌูุฉ ุตุงุญุจ ุงููุทุนู
1. ุงูุชุญ ูุงุฆูุฉ ุงูุทูุจุงุช
2. ุงุฎุชุฑ ุทูุจ ููุจูู (Status = 1)
3. ุงุถุบุท "ุชุนููู ุณุงุฆู"
4. ุงุฎุชุฑ ููุฏูุจ ุฃู ุงุถุบุท "ุชุนููู ุงูุฃูุฑุจ"

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุตู ุฅุดุนุงุฑ ููููุฏูุจ โ
- ูุตู ุฅุดุนุงุฑ ูุตุงุญุจ ุงููุทุนู โ
```

### 2. ูุจูู ุงูููุฏูุจ
```bash
# ูู ูุงุฌูุฉ ุงูููุฏูุจ
1. ุงูุชุญ ุงูุทูุจุงุช ุงููุนููุฉ ูู
2. ุงุถุบุท "ูุจูู ุงูุทูุจ"

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุตู ุฅุดุนุงุฑ ูุตุงุญุจ ุงููุทุนู โ
```

### 3. ุฑูุถ ุงูููุฏูุจ
```bash
# ูู ูุงุฌูุฉ ุงูููุฏูุจ
1. ุงูุชุญ ุงูุทูุจุงุช ุงููุนููุฉ ูู
2. ุงุถุบุท "ุฑูุถ ุงูุทูุจ"
3. ุงูุชุจ ุณุจุจ ุงูุฑูุถ

# ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุตู ุฅุดุนุงุฑ ูุตุงุญุจ ุงููุทุนู ูุน ุงูุณุจุจ โ
```

---

## ๐ ุฃููุงุน ุงูุฅุดุนุงุฑุงุช

| ุงูุญุฏุซ | ุงููุฑุณู | ุงููุณุชูุจู | ุงูุฑุณุงูุฉ | ููุน ุงูุจูุงูุงุช |
|------|--------|---------|---------|--------------|
| ุชุนููู ุงูููุฏูุจ | ุงููุธุงู | ุงูููุฏูุจ | ุทูุจ ุชูุตูู ุฌุฏูุฏ! ๐ | `delivery_assigned` |
| ุชุนููู ุงูููุฏูุจ | ุงููุธุงู | ุงููุทุนู | ุชู ุชุนููู ุงูููุฏูุจ ๐ | `driver_assigned` |
| ูุจูู ุงูููุฏูุจ | ุงูููุฏูุจ | ุงููุทุนู | ุงูููุฏูุจ ูุจู ุงูุทูุจ! โ | `delivery_accepted` |
| ุฑูุถ ุงูููุฏูุจ | ุงูููุฏูุจ | ุงููุทุนู | ุงูููุฏูุจ ุฑูุถ ุงูุทูุจ โ | `delivery_rejected` |

---

## ๐ ุจูุงูุงุช ุงูุฅุดุนุงุฑ (Notification Data)

### ุนูุฏ ุงูุชุนููู
```json
{
  "type": "driver_assigned",
  "orderId": "ORDER_ID",
  "deliveryId": "DELIVERY_ID",
  "deliveryName": "ุงุณู ุงูููุฏูุจ"
}
```

### ุนูุฏ ุงููุจูู
```json
{
  "type": "delivery_accepted",
  "orderId": "ORDER_ID",
  "deliveryId": "DELIVERY_ID",
  "deliveryName": "ุงุณู ุงูููุฏูุจ"
}
```

### ุนูุฏ ุงูุฑูุถ
```json
{
  "type": "delivery_rejected",
  "orderId": "ORDER_ID",
  "deliveryId": "DELIVERY_ID",
  "deliveryName": "ุงุณู ุงูููุฏูุจ",
  "reason": "ุณุจุจ ุงูุฑูุถ"
}
```

---

## ๐๏ธ ูุชุทูุจุงุช ุงูุชุดุบูู

1. โ Firebase Admin SDK ููุนูู
2. โ FCM Tokens ูุญููุธุฉ ููู ูุณุชุฎุฏู
3. โ Channel ID = `food_delivery_channel`
4. โ Priority = `high` ููุฅุดุนุงุฑุงุช ุงูููุฑูุฉ

---

## ๐ ููุงุญุธุงุช

- ุฌููุน ุงูุฅุดุนุงุฑุงุช ุชูุฑุณู ุจู Priority ุนุงููุฉ ูุถูุงู ุงููุตูู ุงูููุฑู
- ุฅุฐุง ูุดู ุฅุฑุณุงู ุงูุฅุดุนุงุฑุ ูุง ุชูุดู ุงูุนูููุฉ (try-catch)
- ูุชู ุญูุธ ุณุจุจ ุงูุฑูุถ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุงููุธุงู ูุจุญุซ ุนู ููุฏูุจ ุขุฎุฑ ุชููุงุฆูุงู ุนูุฏ ุงูุฑูุถ

---

## โ ุงูููุฒุงุช ุงูููุชููุฉ

- [x] ุฅุดุนุงุฑ ููููุฏูุจ ุนูุฏ ุงูุชุนููู
- [x] ุฅุดุนุงุฑ ูููุทุนู ุนูุฏ ุงูุชุนููู
- [x] ุฅุดุนุงุฑ ูููุทุนู ุนูุฏ ูุจูู ุงูููุฏูุจ
- [x] ุฅุดุนุงุฑ ูููุทุนู ุนูุฏ ุฑูุถ ุงูููุฏูุจ
- [x] ุญูุธ ุณุจุจ ุงูุฑูุถ
- [x] ุฅุนุงุฏุฉ ุงูุชุนููู ุงูุชููุงุฆู ุนูุฏ ุงูุฑูุถ

